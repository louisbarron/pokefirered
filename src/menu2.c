#include "global.h"
#include "gflib.h"
#include "task.h"
#include "wild_encounter.h"

static void Task_SmoothBlendLayers(u8 taskId);

static const u8 sMonSpriteAnchorCoords[][5] = {
    [SPECIES_PETALIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PETALUX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PETALIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FLARION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FLARIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VICTIRAH - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VITARI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VITALUXE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AETHERON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AETHRI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VERDIGO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VERALIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VERMEA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TORVIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CELIGRA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CELUMI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FLENURA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FLENIXA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FLORENA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PULSX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PULSAR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PULSITE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TENEBRA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRAGS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRAGNOS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MIRAK - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MIXER - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KRYPTA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRYPTIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRYPTOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KHILRIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ASTEROS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GYROP - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CALLIGO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ASTRUX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VIRIDIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VIRELIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VEIRAN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FURIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_STELLAL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_URAGI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_URAGON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_UROBOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRAGUL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRACAEL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SPIRA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMARA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMARIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TENEBROUS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TENEKROF - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LEMTUR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VINEIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VINEKOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VINTRUB - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MOMOZA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MOMOZOA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MOMORAI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_NURVIO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_NURVIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_NURIMAR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KLOUDA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KLODION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRAZO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRIGRON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRAGO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DOXON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DOXYON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AURARA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AURORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SORVUS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SORVOL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TECHI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TECHSOL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TECHURA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_BRONZIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DUNRAH - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DUNARE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRYSTA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KORVISA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KORVIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KORVAX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SEALORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SEALEIRA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KAIDIKO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PUPATOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AKMIDA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_RIVAGER - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_RIVILE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KARASHY - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AGATORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AGARIKS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AGRAKA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_POCHET - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_POCHETLIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_POJEKT - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SERENITE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SERINAX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMINE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMINON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CELESTIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CELESTUS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_STELARUS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CROQUON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FANGOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VERDURA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VERDUUS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ASTARVE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TUNDRAX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TARNEX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SCROLIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SCROLLUX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AERHONE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AEROLUT - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AERODIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AERTHYS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ARTHYS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CALLISTA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LURAS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LURIOS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LURION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_IGNITOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AQUAVOLE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AKVORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_RHINOKS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ROKITU - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SORILI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_SERILI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMIGA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMINIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_FUMINDO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRAKO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERROBE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRIGON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AEROPE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AEROPEX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VESPAS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_VESPERA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GRAPHSIM - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_EMBRIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_EMBERG - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_EMBLAZE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LEVORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LEVAXON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LEVIORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ROKUIL - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRYSTALUX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CRYSTAZE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TINSTRY - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LIGNANT - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMINANT - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMINUXE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLIMMOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CALCIMONK - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CALCLION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_RUSTHOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ALKON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TINTINN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TINNION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TINNEK - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_LUMINOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_PRANJORA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CHRONIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_IGNIFERT - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_IGNINTO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TERRO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ROCKPIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_QILINI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GELRATH - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GELRAID - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLIMPIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLIMVIR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLIMION - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AURSURF - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AURIVORE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ONYRIX - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ONYXYS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KAELOS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CUIMOS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_KOROBI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_CULMOTH - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_BOUNDI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_BOUNDIERE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GRUMM - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLITAS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_GLITRON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_MISTILE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_YUREKI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_YUKIMI - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_YUMIRA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TURBIN - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TURMADE - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_TURMAG - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ELECTORO - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_ELECTRON - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_EXCAVA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_EXCELSIA - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DUSTOS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_DUSTOR - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AERFER - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},
    [SPECIES_AERAXIS - 1] = {0x16, 0x1b, 0x30, 0x16, 0x29},

};

void AddTextPrinterParameterized3(u8 windowId, u8 fontId, u8 x, u8 y, const u8 * color, s8 speed, const u8 * str)
{
    struct TextPrinterTemplate printer;

    printer.currentChar = str;
    printer.windowId = windowId;
    printer.fontId = fontId;
    printer.x = x;
    printer.y = y;
    printer.currentX = printer.x;
    printer.currentY = printer.y;
    printer.letterSpacing = GetFontAttribute(fontId, FONTATTR_LETTER_SPACING);
    printer.lineSpacing = GetFontAttribute(fontId, FONTATTR_LINE_SPACING);
    printer.unk = 0;
    printer.fgColor = color[1];
    printer.bgColor = color[0];
    printer.shadowColor = color[2];
    AddTextPrinter(&printer, speed, NULL);
}

void AddTextPrinterParameterized4(u8 windowId, u8 fontId, u8 x, u8 y, u8 letterSpacing, u8 lineSpacing, const u8 *color, s8 speed, const u8 *str)
{
    struct TextPrinterTemplate printer;

    printer.currentChar = str;
    printer.windowId = windowId;
    printer.fontId = fontId;
    printer.x = x;
    printer.y = y;
    printer.currentX = printer.x;
    printer.currentY = printer.y;
    printer.letterSpacing = letterSpacing;
    printer.lineSpacing = lineSpacing;
    printer.unk = 0;
    printer.fgColor = color[1];
    printer.bgColor = color[0];
    printer.shadowColor = color[2];
    AddTextPrinter(&printer, speed, NULL);
}

void AddTextPrinterParameterized5(u8 windowId, u8 fontId, const u8 *str, u8 x, u8 y, u8 speed, void (*callback)(struct TextPrinterTemplate *, u16), u8 letterSpacing, u8 lineSpacing)
{
    struct TextPrinterTemplate printer;

    printer.currentChar = str;
    printer.windowId = windowId;
    printer.fontId = fontId;
    printer.x = x;
    printer.y = y;
    printer.currentX = x;
    printer.currentY = y;
    printer.letterSpacing = letterSpacing;
    printer.lineSpacing = lineSpacing;
    printer.unk = 0;
    printer.fgColor = GetFontAttribute(fontId, FONTATTR_COLOR_FOREGROUND);
    printer.bgColor = GetFontAttribute(fontId, FONTATTR_COLOR_BACKGROUND);
    printer.shadowColor = GetFontAttribute(fontId, FONTATTR_COLOR_SHADOW);
    AddTextPrinter(&printer, speed, callback);
}

void Menu_PrintFormatIntlPlayerName(u8 windowId, const u8 * src, u16 x, u16 y)
{
    s32 i;

    for (i = 0; gSaveBlock2Ptr->playerName[i] != EOS; i++)
        ;

    StringExpandPlaceholders(gStringVar4, src);
    if (i != 5)
    {
        AddTextPrinterParameterized(windowId, FONT_NORMAL, gStringVar4, x, y, 0xFF, NULL);
    }
    else
    {
        AddTextPrinterParameterized5(windowId, FONT_NORMAL, gStringVar4, x, y, 0xFF, NULL, 0, 0);
    }
}

static void UnusedBlitBitmapRect(const struct Bitmap *src, struct Bitmap *dst, u16 srcX, u16 srcY, u16 dstX, u16 dstY, u16 width, u16 height)
{
    s32 loopSrcY, loopDstY, loopSrcX, loopDstX, xEnd, yEnd, multiplierSrcY, multiplierDstY;
    u16 toOrr;
    u8 *pixelsSrc;
    u8 *pixelsDst;

    if (dst->width - dstX < width)
        xEnd = dst->width - dstX + srcX;
    else
        xEnd = width + srcX;

    if (dst->height - dstY < height)
        yEnd = srcY + dst->height - dstY;
    else
        yEnd = srcY + height;
    multiplierSrcY = (src->width + (src->width & 7)) >> 3;
    multiplierDstY = (dst->width + (dst->width & 7)) >> 3;
    for (loopSrcY = srcY, loopDstY = dstY; loopSrcY < yEnd; loopSrcY++, loopDstY++)
    {
        for (loopSrcX = srcX, loopDstX = dstX; loopSrcX < xEnd; loopSrcX++, loopDstX++)
        {
            pixelsSrc = (u8 *)(src->pixels + ((loopSrcX >> 1) & 3) + ((loopSrcX >> 3) << 5) + (((loopSrcY >> 3) * multiplierSrcY) << 5) + ((u32)(loopSrcY << 0x1d) >> 0x1B));
            pixelsDst = (u8 *)(dst->pixels + ((loopDstX >> 1) & 3) + ((loopDstX >> 3) << 5) + ((( loopDstY >> 3) * multiplierDstY) << 5) + ((u32)( loopDstY << 0x1d) >> 0x1B));

            if ((u32)pixelsDst & 0x1)
            {
                pixelsDst--;
                if (loopDstX & 0x1)
                {
                    toOrr = *(vu16 *)pixelsDst & 0x0fff;
                    if (loopSrcX & 0x1)
                        toOrr |= ((*pixelsSrc & 0xf0) << 8);
                    else
                        toOrr |= ((*pixelsSrc & 0x0f) << 12);
                }
                else
                {
                    toOrr = *(vu16 *)pixelsDst & 0xf0ff;
                    if (loopSrcX & 0x1)
                        toOrr |= ((*pixelsSrc & 0xf0) << 4);
                    else
                        toOrr |= ((*pixelsSrc & 0x0f) << 8);
                }
            }
            else
            {
                if (loopDstX & 1)
                {
                    toOrr = *(vu16 *)pixelsDst & 0xff0f;
                    if (loopSrcX & 1)
                        toOrr |= ((*pixelsSrc & 0xf0) << 0);
                    else
                        toOrr |= ((*pixelsSrc & 0x0f) << 4);
                }
                else
                {
                    toOrr = *(vu16 *)pixelsDst & 0xfff0;
                    if (loopSrcX & 1)
                        toOrr |= ((*pixelsSrc & 0xf0) >> 4);
                    else
                        toOrr |= ((*pixelsSrc & 0x0f) >> 0);
                }
            }
            *(vu16 *)pixelsDst = toOrr;
        }
    }
}

#define tEvA data[0]
#define tEvB data[1]
#define tEvAEnd data[2]
#define tEvBEnd data[3]
#define tEvADelta data[4]
#define tEvBDelta data[5]
#define tEvWhich data[6]
#define tEvStepCount data[8]

void StartBlendTask(u8 eva_start, u8 evb_start, u8 eva_end, u8 evb_end, u8 ev_step, u8 priority)
{
    u8 taskId = CreateTask(Task_SmoothBlendLayers, priority);
    gTasks[taskId].tEvA = eva_start << 8;
    gTasks[taskId].tEvB = evb_start << 8;
    gTasks[taskId].tEvAEnd = eva_end;
    gTasks[taskId].tEvBEnd = evb_end;
    gTasks[taskId].tEvADelta = (eva_end - eva_start) * 256 / ev_step;
    gTasks[taskId].tEvBDelta = (evb_end - evb_start) * 256 / ev_step;
    gTasks[taskId].tEvStepCount = ev_step;
    SetGpuReg(REG_OFFSET_BLDALPHA, (evb_start << 8) | eva_start);
}

bool8 IsBlendTaskActive(void)
{
    return FuncIsActiveTask(Task_SmoothBlendLayers);
}

static void Task_SmoothBlendLayers(u8 taskId)
{
    s16 * data = gTasks[taskId].data;

    if (tEvStepCount != 0)
    {
        if (tEvWhich == 0)
        {
            tEvA += tEvADelta;
            tEvWhich = 1;
        }
        else
        {
            if (--tEvStepCount != 0)
            {
                tEvB += tEvBDelta;
            }
            else
            {
                tEvA = tEvAEnd << 8;
                tEvB = tEvBEnd << 8;
            }
            tEvWhich = 0;
        }
        SetGpuReg(REG_OFFSET_BLDALPHA, (tEvB & ~0xFF) | ((u16)tEvA >> 8));
        if (tEvStepCount == 0)
            DestroyTask(taskId);
    }
}

u8 Menu2_GetMonSpriteAnchorCoord(u16 species, u32 personality, u8 a2)
{
    if (species != SPECIES_NONE && a2 < 5)
    {
        species--;
        if (sMonSpriteAnchorCoords[species][a2] != 0xFF)
            return sMonSpriteAnchorCoords[species][a2];
    }
    return 32;
}

s8 Menu2_GetMonSpriteAnchorCoordMinusx20(u16 species, u32 personality, u8 a2)
{
    return Menu2_GetMonSpriteAnchorCoord(species, personality, a2) - 32;
}
